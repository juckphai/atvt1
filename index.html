
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕бр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щ</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4a90e2"/>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕бр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щ">
  <link rel="apple-touch-icon" href="./192.png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container" style="padding:0; border:none; background:none;">
    
    <div id="install-guide" class="install-prompt">
      <span class="close-prompt" onclick="hideInstallPromptPermanently()">&times;</span>
      <h4>ЁЯУ▒ р╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕Зр╣Бр╕нр╕Ыр╕Щр╕╡р╣Йр╕ер╕Зр╣Гр╕Щр╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕Вр╕нр╕Зр╕Др╕╕р╕У!</h4>
      <ul>
        <li><b>ЁЯУ▒ р╕кр╕│р╕лр╕гр╕▒р╕Ъ Android:</b> р╣Ар╕Ър╕гр╕▓р╕зр╣Мр╣Ар╕Лр╕нр╕гр╣М Chrome р╕Ир╕░р╕бр╕╡р╕Ыр╕╕р╣Ир╕б "р╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕Зр╣Бр╕нр╕Ы" р╕лр╕гр╕╖р╕н "р╣Ар╕Юр╕┤р╣Ир╕бр╣Др╕Ыр╕вр╕▒р╕Зр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╕лр╕ер╕▒р╕Б" р╣Бр╕кр╕Фр╕Зр╕Вр╕╢р╣Йр╕Щр╕бр╕▓р╣Гр╕лр╣Йр╕Бр╕Ф</li>
        <li><b>ЁЯУ▒ р╕кр╕│р╕лр╕гр╕▒р╕Ъ iPhone (iOS):</b> р╣Ар╕Ыр╕┤р╕Фр╣Гр╕Щ Safari р╣Бр╕ер╣Йр╕зр╕Бр╕Фр╕Чр╕╡р╣Ир╕Ыр╕╕р╣Ир╕б "р╣Бр╕Кр╕гр╣М" (Share) р╕Ир╕▓р╕Бр╕Щр╕▒р╣Йр╕Щр╣Ар╕ер╕╖р╕нр╕Б "р╣Ар╕Юр╕┤р╣Ир╕бр╣Др╕Ыр╕вр╕▒р╕Зр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╣Вр╕ор╕б" (Add to Home Screen)</li>
      </ul>
      <div style="text-align: center; margin-top: 2px;">
        <button onclick="hideInstallPromptPermanently()" style="background-color: #6c757d; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer;">
          тЭМ р╣Др╕бр╣Ир╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Щр╕╡р╣Йр╕нр╕╡р╕Б
        </button>
      </div>
    </div>

    <div style="text-align: center; margin-top: 2px;">
      <div class="container">
        <div style="width: 100%; max-width: 900px; margin: 10px auto;">
       
          <div style="display: flex; justify-content: center; align-items: center; margin: 10px 0;">
            <div class="button-container" 
                 style="display: flex; justify-content: center; flex-wrap: wrap; gap: 5px; padding: 0 10px;">
              
              <button 
                type="button" 
                onclick="document.getElementById('restoreFile').click()" 
                style="
                  background-color: #196B24;
                  color: white;
                  font-weight: bold;
                  padding: 5px 15px;
                  height: 36px;
                  font-size: 0.8rem;
                  border: 3px solid #FF33CC;
                  border-radius: 50px;
                  cursor: pointer;
                  transition: all 0.3s ease;
                  white-space: nowrap;
                  width: fit-content;
                  touch-action: manipulation;
                "
                onmouseover="this.style.backgroundColor='#145a1d'"
                onmouseout="this.style.backgroundColor='#196B24'"
                ontouchstart="this.style.backgroundColor='#145a1d'"
                ontouchend="this.style.backgroundColor='#196B24'">
                ЁЯУВ р╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б
              </button>

              <input 
                type="file" 
                id="restoreFile" 
                accept=".json" 
                style="display: none;" 
                onchange="restoreData(this.files[0])">
            </div>
          </div>
          
          <div class="section-header main-section-header header-add-data" onclick="toggleMainSection('add-activity-section')">
            <span>тЮХ р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б</span>
            <span class="menu-icon">тЦ╝</span>
          </div>
          <div id="add-activity-section" class="section-content main-section-content">
            <div class="form-section no-border">
              <form id="activity-form">
                
 <div class="management-row compact-layout">
  <div class="management-container full-width">
    <div class="select-wrapper" 
         style="display: flex; align-items: center; gap: 6px; width: 100%;">
      
      <button 
        type="button" 
        class="manage-btn-inline" 
        id="togglePersonControls" 
        title="р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Ьр╕╣р╣Йр╕Ър╕нр╕Б" 
        style="font-size: clamp(0.5rem, 2.5vw, 1rem);"
      >
        тЪЩя╕П
      </button>

      <select 
        id="personSelect" 
        required 
        style="
          flex: 1;
          font-size: 14px;
          padding: 6px 10px;
          border-radius: 6px;
          height: 34px;
        "
      >
        <option value="">ЁЯСд р╣Ар╕ер╕╖р╕нр╕Бр╕Ьр╕╣р╣Йр╕Чр╕│р╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б</option>
      </select>
    </div>

    <div class="management-actions" id="personActions" style="display: none;">
      <button type="button" id="addPersonBtn" class="add-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">тЮХ р╣Ар╕Юр╕┤р╣Ир╕б</button>
      <button type="button" id="editPersonBtn" class="edit-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">тЬПя╕П р╣Бр╕Бр╣Йр╣Др╕В</button>
      <button type="button" id="deletePersonBtn" class="delete-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">ЁЯЧСя╕П р╕ер╕Ъ</button>
      <button type="button" id="resetPersonBtn" class="reset-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">ЁЯФД р╕Др╕╖р╕Щр╕Др╣Ир╕▓</button>
    </div>
  </div>

  <div class="management-container full-width">
    <div class="select-wrapper" 
         style="display: flex; align-items: center; gap: 6px; width: 100%;">

      <button 
        type="button" 
        class="manage-btn-inline" 
        id="toggleActivityTypeControls"
        title="р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕лр╕▒р╕зр╕Вр╣Йр╕н"
        style="font-size: clamp(0.5rem, 2.5vw, 1rem);"
      >
        тЪЩя╕П
      </button>

      <select 
        id="activityTypeSelect" 
        required 
        style="
          flex: 1;
          font-size: 14px;
          padding: 6px 10px;
          border-radius: 6px;
          height: 34px;
        "
      >
        <option value="">ЁЯУК р╣Ар╕ер╕╖р╕нр╕Бр╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б</option>
      </select>
    </div>

    <div class="management-actions" id="activityTypeActions" style="display: none;">
      <button type="button" id="addActivityTypeBtn" class="add-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">тЮХ р╣Ар╕Юр╕┤р╣Ир╕б</button>
      <button type="button" id="editActivityTypeBtn" class="edit-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">тЬПя╕П р╣Бр╕Бр╣Йр╣Др╕В</button>
      <button type="button" id="deleteActivityTypeBtn" class="delete-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">ЁЯЧСя╕П р╕ер╕Ъ</button>
      <button type="button" id="resetActivityTypeBtn" class="reset-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">ЁЯФД р╕Др╕╖р╕Щр╕Др╣Ир╕▓</button>
    </div>
  </div>
</div>
                
<div class="date-wrapper" 
     style="display: flex; justify-content: center; align-items: center; margin-bottom: 2px; width: 100%;">
  
  <label for="activity-date" 
         style="margin-right: 4px; font-size: clamp(0.8rem, 2.5vw, 1rem); white-space: nowrap;">
    ЁЯУЕ р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣И : 
  </label>
  
  <input type="date" id="activity-date" 
         style="font-size: clamp(0.8rem, 2.5vw, 1rem); padding: 4px; max-width: 250px; width: 60%;">
</div>

<div class="time-inputs-section">
  <div class="time-input-group duration-block" 
       style="width: 100%; max-width: 400px; margin: 0 auto;"> <div class="date-wrapper duration-wrapper" 
         style="display: flex; justify-content: center; align-items: center; width: 100%; margin-bottom: 2px;">
      
      <label class="display-date" 
             style="font-size: clamp(0.8rem, 2.5vw, 1rem); white-space: nowrap; font-weight: normal; color: #000; margin: 0 auto; text-align: center;">
        тП▒я╕П р╕гр╕░р╕вр╕░р╣Ар╕зр╕ер╕▓ :
      </label>
    </div>

    <div class="duration-inputs-container" 
         style="display: flex; justify-content: center; align-items: center; gap: 10px; width: 100%; margin-top: 5px;"> 
      
      <div class="duration-input-group" style="flex: 0 0 auto;"> <input type="number" id="duration-hours" min="0" max="23" value="1" placeholder="р╕Кр╕б." required 
               style="width: 70px; padding: 6px; text-align: center; font-size: clamp(0.8rem, 2.5vw, 1rem); border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box;">
        <span class="duration-label" style="font-size: 0.8rem; margin-top: 4px;">ЁЯХР р╕Кр╕▒р╣Ир╕зр╣Вр╕бр╕З</span>
      </div>
      <div class="duration-input-group" style="flex: 0 0 auto;"> <input type="number" id="duration-minutes" min="0" max="59" value="0" placeholder="р╕Щ." required 
               style="width: 70px; padding: 6px; text-align: center; font-size: clamp(0.8rem, 2.5vw, 1rem); border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box;">
        <span class="duration-label" style="font-size: 0.8rem; margin-top: 4px;">тП░ р╕Щр╕▓р╕Чр╕╡</span>
      </div>
        
    </div>
  </div>


        <div class="time-row" style="display: flex; justify-content: center; gap: 4px; margin-top: 2px;">
          <div class="time-input-group">
            <div class="date-wrapper">
              <input type="time" id="start-time" readonly style="background-color: #f0f0f0;">
              <label for="start-time" class="time-label-bottom" style="margin-top: 2px;">тП░ р╣Ар╕зр╕ер╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ</label>
            </div>
          </div>
          <div class="time-input-group">
            <div class="date-wrapper">
              <input type="time" id="end-time" required>
              <label for="end-time" class="time-label-bottom" style="margin-top: 2px;">тП░ р╣Ар╕зр╕ер╕▓р╕кр╕┤р╣Йр╕Щр╕кр╕╕р╕Ф</label>
            </div>
          </div>
        </div>
      </div>

      <div style="display: flex; flex-direction: column; align-items: center; width: 100%; margin-top: 2px;">
        <label for="activity-details" style="text-align: center; width: 100%; margin-bottom: 2px;">ЁЯУД р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б (р╣Др╕бр╣Ир╕Ър╕▒р╕Зр╕Др╕▒р╕Ъ):</label>
        <textarea 
          id="activity-details" 
          placeholder="р╣Ар╕Кр╣Ир╕Щ р╕Бр╕▓р╕гр╕Ыр╕гр╕░р╕Кр╕╕р╕бр╕Бр╕▒р╕Ър╕Чр╕╡р╕б, р╕нр╣Ир╕▓р╕Щр╕лр╕Щр╕▒р╕Зр╕кр╕╖р╕нр╕Ър╕Чр╕Чр╕╡р╣И 5"
          style="width: 100%; max-width: 500px; margin: 0 auto; display: block; padding: 6px;"
        ></textarea>
      </div>
      
      <div class="center" style="margin-top: 2px;">
        <button id="save-activity-button" class="main-button">ЁЯТ╛ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б</button>
      </div>

      <div class="button-container" style="margin-top: 2px;">
        <button type="button" class="main-button" onclick="toggleActivitiesVisibility()">ЁЯСБя╕П р╣Бр╕кр╕Фр╕З/р╕Лр╣Ир╕нр╕Щр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</button>
      </div>

      <button type="button" id="update-activity-button" class="hidden">ЁЯФД р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б</button>
      <button type="button" id="cancel-edit-activity-button" class="hidden">тЭМ р╕вр╕Бр╣Ар╕ер╕┤р╕Б</button>
      
      <p id="activity-message" class="error-message" style="margin-top: 2px;"></p>
    </form>
  </div>
</div>

        
<div class="section-header main-section-header header-actions" onclick="toggleMainSection('manage-activities-section')">
  <span>тЪЩя╕П р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б</span>
  <span class="menu-icon">тЦ╝</span>
</div>

<div id="manage-activities-section" class="section-content main-section-content">
  <div class="form-section no-border">
    <form id="manage-activities-form">

      <div style="text-align: center; margin: 2px 0;">
        <p id="password-status"
           style="margin: 2px 0; font-size: clamp(0.7rem, 1.5vw, 1rem); color: #f5a623;">
          ЁЯФТ р╕кр╕Цр╕▓р╕Щр╕░: р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ (р╣Др╕Яр╕ер╣Мр╕кр╕│р╕гр╕нр╕Зр╕Ир╕░р╣Др╕бр╣Ир╕Цр╕╣р╕Бр╣Ар╕Вр╣Йр╕▓р╕гр╕лр╕▒р╕к)
        </p>
      </div>

      <div style="display: flex; justify-content: center; gap: 8px; margin: 4px 0;">
        <button type="button" onclick="saveToLocal()" 
                style="width: 160px; border-radius: 30px; background-color: #17a2b8; padding: 8px;">
          ЁЯТ╛ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Кр╕▒р╣Ир╕зр╕Др╕гр╕▓р╕з
        </button>
        <button type="button" onclick="openExportOptionsModal()" 
                style="width: 160px; border-radius: 30px; background-color: #0d47a1; padding: 8px;">
          ЁЯТ╛ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е
        </button>
      </div>

      <div class="entry-group" style="font-size: clamp(0.8rem, 2.5vw, 1rem); margin-top: 2px;">
        <label for="backup-password">ЁЯФР р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е (р╣Др╕бр╣Ир╕Ър╕▒р╕Зр╕Др╕▒р╕Ъ):</label>
        <div style="position: relative; margin-top: 2px;">
          <input
            type="password"
            id="backup-password"
            placeholder="р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ р╣Гр╕лр╣Йр╕Ыр╕ер╣Ир╕нр╕вр╕зр╣Ир╕▓р╕Зр╣Др╕зр╣Й"
            style="width: 100%; padding-right: 40px; padding: 8px; font-size: clamp(0.5rem, 2.5vw, 1.2rem); border-radius: 8px;"
          >
          <span id="toggle-password"
                style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; user-select: none; font-size: clamp(0.8rem, 2.5vw, 1rem);">
            ЁЯСБя╕П
          </span>
        </div>
      </div>

      <div class="entry-group" style="margin-top: 2px;">
        <label for="backup-password-confirm">ЁЯФР р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ:</label>
        <div style="position: relative; margin-top: 2px;">
          <input type="password" id="backup-password-confirm" placeholder="р╕Бр╕гр╕нр╕Бр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕З"
                 style="width: 100%; padding-right: 40px; padding: 8px; font-size: clamp(0.5rem, 2.5vw, 1.2rem); border-radius: 8px;">
          <span id="toggle-password-confirm"
                style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; user-select: none;">
            ЁЯСБя╕П
          </span>
        </div>
      </div>

      <div style="display: flex; justify-content: center; gap: 8px; margin-top: 2px;">
        <button type="button" onclick="saveBackupPassword(event)"
                style="width: 160px; border-radius: 30px; background-color: #28a745; padding: 8px;">
          ЁЯФТ р╕Хр╕▒р╣Йр╕Зр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
        </button>
        <button type="button" onclick="clearBackupPassword()"
                style="width: 160px; border-radius: 30px; background-color: #dc3545; padding: 8px;">
          тЭМ р╕ер╕Ър╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
        </button>
      </div>

      <div class="summary-subsection" style="margin-top: 2px;">
        <div style="display: flex; justify-content: center; margin-bottom: 2px;">
          <button type="button" onclick="cleanAllData()"
                  class="clean-data-btn"
                  style="background-color: #ff5722; border-radius: 30px; color: white; padding: 8px 18px;">
            ЁЯз╣ р╕Чр╕│р╕Др╕зр╕▓р╕бр╕кр╕░р╕нр╕▓р╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
          </button>
        </div>
        <p style="text-align: center; font-size: 0.85rem; color: #666; margin-top: 2px;">
          ЁЯФН р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕╕р╕Вр╕ар╕▓р╕Юр╕Вр╣Йр╕нр╕бр╕╣р╕е, р╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Лр╣Йр╕│, р╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕бр╕Вр╕вр╕░ р╣Бр╕ер╕░р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕Ир╕│р╣Ар╕Ыр╣Зр╕Щ
        </p>
      </div>

    </form>
  </div>
</div>


          
          <div class="section-header main-section-header header-summary" onclick="toggleMainSection('summary-section')">
            <span>ЁЯУК р╕кр╕гр╕╕р╕Ыр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б</span>
            <span class="menu-icon">тЦ╝</span>
          </div>
          <div id="summary-section" class="section-content main-section-content">
            <div class="form-section no-border">
              <form id="summary-form">
                <div class="entry-form" style="margin-bottom: 2;">
                  <div class="entry-group">
                    <label for="summary-type-select">ЁЯУИ р╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Бр╕▓р╕гр╕кр╕гр╕╕р╕Ы:</label>
                    <select id="summary-type-select" onchange="loadSummaryData()">
                      <option value="brief-summary">ЁЯУЛ р╕кр╕гр╕╕р╕Ыр╕нр╕вр╣Ир╕▓р╕Зр╕вр╣Ир╕н</option>
                      <option value="single-day">ЁЯУЕ р╕Хр╕▓р╕бр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Ар╕ер╕╖р╕нр╕Б</option>
                      <option value="date-range">ЁЯУЖ р╕Хр╕▓р╕бр╕Кр╣Ир╕зр╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣И</option>
                      <option value="all-time">ЁЯУК р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</option>
                    </select>
                  </div>
                </div>

                <div class="summary-controls">
                  <!-- р╣Бр╕Бр╣Йр╣Др╕Вр╕кр╣Ир╕зр╕Щр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Кр╕╖р╣Ир╕нр╣Бр╕Ър╕Ъ auto-selected р╕Чр╕╡р╣Ир╕Щр╕╡р╣И -->
                  <div class="auto-selected-person" id="autoSelectedPerson" style="display: none; background-color: #f8f9fa; padding: 8px 12px; border-radius: 15px; border: 1px solid #dee2e6; margin-bottom: 2px; text-align: center;">
                    <label style="font-weight: bold; margin-right: 8px; color: #495057; display: inline-block; width: auto; margin-bottom: 0;">ЁЯСд р╕Ьр╕╣р╣Йр╕Чр╕│р╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б:</label>
                    <span id="selectedPersonName" style="color: #28a745; font-size: 1rem; font-weight: bold;"></span>
                  </div>

                  <div class="person-filter-container" id="personFilterContainer">
                    <label for="personFilter">ЁЯСд р╕Ьр╕╣р╣Йр╕Чр╕│р╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б:</label>
                    <select id="personFilter" onchange="loadSummaryData()">
                      <option value="all">ЁЯСе р╕Чр╕╕р╕Бр╕Др╕Щ</option>
                    </select>
                  </div>
                </div>
                
                <div id="summary-date-picker" class="summary-subsection hidden">
                  <label class="summary-subsection-header">ЁЯУЕ р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣И</label>
                  <div class="summary-date-display">
                    <div class="date-label">ЁЯУЕ р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣И:</div>
                    <input type="date" id="summary-date" style="width: 100%; max-width: 200px; padding: 8px; font-size: 14px;">
                  </div>
                </div>

                <div id="summary-date-range" class="summary-subsection hidden">
                  <label class="summary-subsection-header">ЁЯУЖ р╣Ар╕ер╕╖р╕нр╕Бр╕Кр╣Ир╕зр╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣И</label>
                  <div class="summary-date-display">
                    <div class="date-label">ЁЯУЕ р╕Ир╕▓р╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣И:</div>
                    <input type="date" id="summary-start-date" style="width: 100%; max-width: 200px; padding: 8px; font-size: 14px;">
                  </div>
                  <div class="summary-date-display">
                    <div class="date-label">ЁЯУЕ р╕Цр╕╢р╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣И:</div>
                    <input type="date" id="summary-end-date" style="width: 100%; max-width: 200px; padding: 8px; font-size: 14px;">
                  </div>
                </div>
                
                <div class="summary-subsection">
                  <div class="button-container" style="text-align: center; margin-top: 2px;">
                    <button 
                      type="button" 
                      onclick="viewSummary()" 
                      style="
                        display: inline-block;
                        background-color: #FF00FF;
                        color: #fff;
                        border: 2px solid #4527a0;
                        border-radius: 30px;
                        padding: 5px 15px;
                        font-size: 16px;
                        font-weight: 500;
                        cursor: pointer;
                        box-shadow: 0 3px 6px rgba(0,0,0,0.2);
                        transition: all 0.25s ease;
                        width: auto;
                        min-width: fit-content;
                      "
                      onmouseover="this.style.transform='scale(1.05)'"
                      onmouseout="this.style.transform='scale(1)'"
                    >
                      ЁЯУК р╕Фр╕╣р╕кр╕гр╕╕р╕Ы
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>    
      </div>   
    </div>

    <div id="activitiesSection" style="display: none; margin-top: 2px; width: 100%;">
      <div class="table-container">
        <table id="activityTable">
          <thead>
            <tr>
              <th>ЁЯУЕ р╕зр╕▒р╕Щр╣Ар╕Фр╕╖р╕нр╕Щр╕Ыр╕╡</th>
              <th>тП░ р╣Ар╕зр╕ер╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ</th>
              <th>ЁЯСд р╕Ьр╕╣р╣Йр╕Чр╕│р╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б</th>
              <th>ЁЯУК р╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б</th>
              <th>тП▒я╕П р╕гр╕░р╕вр╕░р╣Ар╕зр╕ер╕▓</th>
              <th>ЁЯУД р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф</th>
              <th>ЁЯФз р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕г</th>
            </tr>
          </thead>
          <tbody id="activityBody"></tbody>
        </table>
      </div>
    </div>

    <div id="summaryModal" class="modal-overlay">
      <div class="modal-content-container">
        <div id="modalBodyContent" class="summaryResult">
          </div>
        <div class="modal-controls">
          <button id="saveSummaryAsImageBtn" class="modal-control-btn">ЁЯЦ╝я╕П р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Ар╕Ыр╣Зр╕Щр╕гр╕╣р╕Ыр╕ар╕▓р╕Ю</button>
          <button type="button" onclick="closeSummaryModal()" class="modal-close-btn modal-control-btn">тЭМ р╕Ыр╕┤р╕Фр╕лр╕Щр╣Йр╕▓р╕Хр╣Ир╕▓р╕Зр╕Щр╕╡р╣Й</button>
        </div>
      </div>
    </div>

    <div id="summaryOutputModal" class="modal-overlay">
      <div class="format-modal-content">
        <h3>ЁЯУК р╣Ар╕ер╕╖р╕нр╕Бр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕кр╕гр╕╕р╕Ы</h3>
        <div class="format-modal-buttons">
          <button type="button" class="btn-display" onclick="handleSummaryOutput('display')">ЁЯУ║ р╣Бр╕кр╕Фр╕Зр╕Ър╕Щр╕Ир╕н</button>
          <button type="button" class="btn-xlsx" onclick="handleSummaryOutput('xlsx')">ЁЯУК р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Ар╕Ыр╣Зр╕Щ XLSX</button>
          <button type="button" class="btn-pdf" onclick="handleSummaryOutput('pdf')">ЁЯУД р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Ар╕Ыр╣Зр╕Щ PDF</button>
          <button type="button" class="btn-cancel" onclick="closeSummaryOutputModal()">тЭМ р╕вр╕Бр╣Ар╕ер╕┤р╕Б</button>
        </div>
      </div>
    </div>

    <div id="personModal" class="popup-overlay">
      <div class="popup-content" style="max-width: 600px; background-color: #f0f8ff;">
        <h2 id="personModalTitle" style="color: #0056b3; text-align: center;"></h2>
        <input type="hidden" id="personEditValue">
        <input type="text" id="modalPersonName" placeholder="ЁЯСд р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Чр╕│р╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б">
        <div class="modal-button-group">
          <button type="button" id="savePersonBtn" style="background-color: #28a745;">ЁЯТ╛ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Б</button>
          <button type="button" id="cancelPersonBtn" class="close-popup-btn">тЭМ р╕вр╕Бр╣Ар╕ер╕┤р╕Б</button>
        </div>
      </div>
    </div>

    <div id="activityTypeModal" class="popup-overlay">
      <div class="popup-content" style="max-width: 600px; background-color: #f0f8ff;">
        <h2 id="activityTypeModalTitle" style="color: #0056b3; text-align: center;"></h2>
        <input type="hidden" id="activityTypeEditValue">
        <input type="text" id="modalActivityTypeName" placeholder="ЁЯУК р╕Кр╕╖р╣Ир╕нр╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б">
        <div class="modal-button-group">
          <button type="button" id="saveActivityTypeBtn" style="background-color: #28a745;">ЁЯТ╛ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Б</button>
          <button type="button" id="cancelActivityTypeBtn" class="close-popup-btn">тЭМ р╕вр╕Бр╣Ар╕ер╕┤р╕Б</button>
        </div>
      </div>
    </div>

    <div id="print-container" style="display: none;"></div>

    <div id="toast" class="toast-notification" style="display: none;"></div>

    <div id="exportOptionsModal" class="modal-overlay">
      <div class="format-modal-content">
        <h3>ЁЯТ╛ р╣Ар╕ер╕╖р╕нр╕Бр╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е</h3>
        <div class="format-modal-buttons">
          <button onclick="saveToFile()" style="background-color: #0d47a1;">ЁЯТ╛ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Чр╕╕р╕Бр╕Ър╕▒р╕Нр╕Кр╕╡)</button>
          <button onclick="exportSelectedAccount()" style="background-color: #ff9800;">ЁЯТ╛ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ър╕▒р╕Нр╕Кр╕╡р╕Чр╕╡р╣Ир╣Ар╕ер╕╖р╕нр╕Б (р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф)</button>
          <button onclick="initiateSingleDateExport()" style="background-color: #009688;">ЁЯУЕ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Ар╕Йр╕Юр╕▓р╕░р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Ар╕ер╕╖р╕нр╕Б (р╕Ър╕▒р╕Нр╕Кр╕╡р╕Щр╕╡р╣Й)</button>
          <button class="btn-cancel" onclick="closeExportOptionsModal()">тЭМ р╕вр╕Бр╣Ар╕ер╕┤р╕Б</button>
        </div>
      </div>
    </div>

    <div id="singleDateExportModal" class="modal-overlay">
      <div class="format-modal-content">
        <h3>ЁЯУЖ р╣Ар╕ер╕╖р╕нр╕Бр╕Кр╣Ир╕зр╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б</h3>
        <p>ЁЯУБ р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕▓р╕Бр╕Ър╕▒р╕Нр╕Кр╕╡: <strong id="singleDateAccountName"></strong></p>
        
        <div class="entry-form" style="margin-bottom: 2px;">
          <div class="entry-group">
            <label for="exportStartDate">ЁЯУЕ р╕Ир╕▓р╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣И:</label>
            <input type="date" id="exportStartDate" required>
          </div>
          <div class="entry-group">
            <label for="exportEndDate">ЁЯУЕ р╕Цр╕╢р╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣И:</label>
            <input type="date" id="exportEndDate" required>
          </div>
        </div>
        
        <div class="format-modal-buttons">
          <button class="btn-display" onclick="processDateRangeExport()">ЁЯТ╛ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е</button>
          <button class="btn-cancel" onclick="closeSingleDateExportModal()">тЭМ р╕вр╕Бр╣Ар╕ер╕┤р╕Б</button>
        </div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
  
  <script>
    // р╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щ Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('./service-worker.js')
          .then(function(registration) {
            console.log('Service Worker р╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И: ', registration.scope);
          })
          .catch(function(error) {
            console.log('Service Worker р╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╕ер╣Йр╕бр╣Ар╕лр╕ер╕з: ', error);
          });
      });
    }

    // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Бр╕▓р╕гр╕нр╕▒р╕Юр╣Ар╕Фр╕Ч Service Worker р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
    navigator.serviceWorker.addEventListener('controllerchange', function() {
      console.log('Service Worker р╕Цр╕╣р╕Бр╕нр╕▒р╕Юр╣Ар╕Фр╕Чр╣Бр╕ер╣Йр╕з');
      window.location.reload();
    });
    
    // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╣Бр╕Ър╕Ър╕бр╕╖р╕нр╕Цр╕╖р╕н
    function toggleMobileManagement(actionsId) {
      const actions = document.getElementById(actionsId);
      if (actions.style.display === 'flex') {
        actions.style.display = 'none';
      } else {
        actions.style.display = 'flex';
      }
    }
    
    // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕З/р╕Лр╣Ир╕нр╕Щр╣Ар╕бр╕Щр╕╣р╕Ир╕▒р╕Фр╕Бр╕▓р╕г (р╣Ар╕Йр╕Юр╕▓р╕░р╕кр╣Ир╕зр╕Щр╕Яр╕▒р╕Щр╣Ар╕Яр╕╖р╕нр╕З)
    function toggleManagementActions(event, actionsId) {
      // р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╣Др╕бр╣Ир╣Гр╕лр╣Й event р╣Др╕Ыр╕Бр╕гр╕░р╕Хр╕╕р╣Йр╕Щр╕Яр╕нр╕гр╣Мр╕бр╕лр╕ер╕▒р╕Б
      if (event) {
        event.preventDefault();
        event.stopPropagation();
      }
      
      const actions = document.getElementById(actionsId);
      if (actions.style.display === 'flex') {
        actions.style.display = 'none';
      } else {
        // р╕Лр╣Ир╕нр╕Щр╣Ар╕бр╕Щр╕╣р╕нр╕╖р╣Ир╕Щр╣Ж р╕Чр╕╡р╣Ир╕нр╕▓р╕Ир╣Ар╕Ыр╕┤р╕Фр╕нр╕вр╕╣р╣И
        const allActions = document.querySelectorAll('.management-actions');
        allActions.forEach(action => {
          if (action.id !== actionsId) {
            action.style.display = 'none';
          }
        });
        
        actions.style.display = 'flex';
      }
    }
    
    // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕кр╕Фр╕З/р╕Лр╣Ир╕нр╕Щр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
    function toggleActivitiesVisibility() {
      const activitiesSection = document.getElementById('activitiesSection');
      if (activitiesSection.style.display === 'none') {
        activitiesSection.style.display = 'block';
        loadUserActivities();
      } else {
        activitiesSection.style.display = 'none';
      }
    }

    // р╣Ар╕Юр╕┤р╣Ир╕б Event Listeners р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ыр╕╕р╣Ир╕бр╕Яр╕▒р╕Щр╣Ар╕Яр╕╖р╕нр╕Зр╣Ар╕бр╕╖р╣Ир╕нр╣Вр╕лр╕ер╕Фр╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ъ
    document.addEventListener('DOMContentLoaded', function() {
      // р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ьр╕╣р╣Йр╕Чр╕│р╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б
      const togglePersonBtn = document.getElementById('togglePersonControls');
      if (togglePersonBtn) {
        togglePersonBtn.addEventListener('click', function(event) {
          toggleManagementActions(event, 'personActions');
        });
      }
      
      // р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б
      const toggleActivityTypeBtn = document.getElementById('toggleActivityTypeControls');
      if (toggleActivityTypeBtn) {
        toggleActivityTypeBtn.addEventListener('click', function(event) {
          toggleManagementActions(event, 'activityTypeActions');
        });
      }
      
      // р╕Лр╣Ир╕нр╕Щр╣Ар╕бр╕Щр╕╣р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ
      const allActions = document.querySelectorAll('.management-actions');
      allActions.forEach(action => {
        action.style.display = 'none';
      });

      // р╣Ар╕Юр╕┤р╣Ир╕б event listener р╣Ар╕Юр╕╖р╣Ир╕нр╕Лр╣Ир╕нр╕Щр╣Ар╕бр╕Щр╕╣р╣Ар╕бр╕╖р╣Ир╕нр╕Др╕ер╕┤р╕Бр╕Щр╕нр╕Бр╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣И
      document.addEventListener('click', function(event) {
        const allActions = document.querySelectorAll('.management-actions');
        const isClickInsidePersonActions = document.getElementById('personActions')?.contains(event.target);
        const isClickInsideActivityTypeActions = document.getElementById('activityTypeActions')?.contains(event.target);
        const isClickOnPersonToggle = event.target.closest('#togglePersonControls');
        const isClickOnActivityTypeToggle = event.target.closest('#toggleActivityTypeControls');
        
        if (!isClickInsidePersonActions && !isClickOnPersonToggle) {
          const personActions = document.getElementById('personActions');
          if (personActions) personActions.style.display = 'none';
        }
        
        if (!isClickInsideActivityTypeActions && !isClickOnActivityTypeToggle) {
          const activityTypeActions = document.getElementById('activityTypeActions');
          if (activityTypeActions) activityTypeActions.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>